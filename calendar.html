const menu = document.getElementById("mailContext");
if (menu) {
  menu.addEventListener("popupshown", () => {
    const keyHandler = (e) => {
      if (e.ctrlKey || e.altKey || e.metaKey || !e.key || e.key.length !== 1) return;
      if (e.key < "А" || e.key > "я") return;

      const enKey = e.code.replace("Key", "");
      e.target.dispatchEvent(new KeyboardEvent("keydown", {
        key: enKey.toLowerCase(),
        code: e.code,
        keyCode: enKey.charCodeAt(0),
        bubbles: true,
        cancelable: true
      }));

      e.preventDefault();
      e.stopPropagation();
    };

    window.addEventListener("keydown", keyHandler);
    menu.addEventListener("popuphidden", () => window.removeEventListener("keydown", keyHandler), { once: true });
  });
}
