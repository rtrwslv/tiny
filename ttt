<div class="qfb-splitbutton" id="qfb-tags">
  <button class="qfb-filterbutton" id="qfb-tags-main">
    <span class="tag-icon">üè∑</span> –ú–µ—Ç–∫–∏ ‚ñæ
  </button>
  <ul id="qfb-tags-menu" class="qfb-menu hidden">
    <li data-tag="$label1"><span class="tag-dot red"></span> –í–∞–∂–Ω–æ–µ</li>
    <li data-tag="$label2"><span class="tag-dot blue"></span> –†–∞–±–æ—á–µ–µ</li>
    <li data-tag="$label3"><span class="tag-dot green"></span> –õ–∏—á–Ω–æ–µ</li>
    <li data-tag="$label4"><span class="tag-dot orange"></span> –ö –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é</li>
    <li data-tag="$label5"><span class="tag-dot purple"></span> –û—Ç–ª–æ–∂–µ–Ω–æ</li>
    <li class="divider"></li>
    <li data-action="reset"><span class="tag-reset">‚úï</span> –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</li>
  </ul>
</div>

.qfb-splitbutton {
  position: relative;
  display: inline-block;
}

.qfb-filterbutton {
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
}

.qfb-menu {
  position: absolute;
  top: 100%;
  left: 0;
  background: var(--toolbar-bg);
  border: 1px solid var(--chrome-content-separator-color);
  border-radius: 4px;
  list-style: none;
  padding: 4px 0;
  margin: 4px 0 0 0;
  min-width: 180px;
  z-index: 1000;
}

.qfb-menu.hidden {
  display: none;
}

.qfb-menu li {
  padding: 6px 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
}

.qfb-menu li:hover {
  background: var(--toolbarbutton-hover-background);
}

.qfb-menu .divider {
  border-top: 1px solid var(--chrome-content-separator-color);
  margin: 4px 0;
  padding: 0;
}

.tag-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  display: inline-block;
  margin-right: 8px;
}

.tag-dot.red { background: #e53935; }
.tag-dot.blue { background: #1e88e5; }
.tag-dot.green { background: #43a047; }
.tag-dot.orange { background: #fb8c00; }
.tag-dot.purple { background: #8e24aa; }

.tag-reset {
  margin-right: 8px;
  color: #777;
}


let tagsBtn = document.getElementById("qfb-tags-main");
let tagsMenu = document.getElementById("qfb-tags-menu");

// –ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –º–µ–Ω—é
tagsBtn.addEventListener("click", e => {
  e.stopPropagation();
  tagsMenu.classList.toggle("hidden");
});

// –≤—ã–±–æ—Ä –ø—É–Ω–∫—Ç–∞
tagsMenu.addEventListener("click", e => {
  if (e.target.closest("li")) {
    let li = e.target.closest("li");
    if (li.dataset.tag) {
      QuickFilterManager.setFilter("tags", { key: li.dataset.tag });
      QuickFilterBarMuxer.deferredUpdateSearch();
    } else if (li.dataset.action === "reset") {
      QuickFilterManager.clearFilter("tags");
      QuickFilterBarMuxer.deferredUpdateSearch();
    }
    tagsMenu.classList.add("hidden");
  }
});

// –∑–∞–∫—Ä—ã–≤–∞—Ç—å –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
document.addEventListener("click", () => tagsMenu.classList.add("hidden"));
